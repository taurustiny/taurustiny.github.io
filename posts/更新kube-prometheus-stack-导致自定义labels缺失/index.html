<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>æ›´æ–°kube-prometheus-stack å¯¼è‡´è‡ªå®šä¹‰labelsç¼ºå¤± | Taurus Tiny</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="TL;DR ğŸ”—k8s é›†ç¾¤æ›´æ–°ç›‘æ§ kube-prometheus-stackå¯¼è‡´k8s resourcesè‡ªå®šä¹‰labels ä¸¢å¤± Chart Versionï¼š 19.2.3 &mdash;&gt; 30.0.1 R">
<meta name="generator" content="Hugo 0.86.0-DEV" />


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="stylesheet" href="/css/style.css">



<link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />








  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">â†</span>é¦–é¡µ</a>
	
	<a href="/posts">å½’æ¡£</a>
	<a href="/categories">åˆ†ç±»</a>
	<a href="/tags">æ ‡ç­¾</a>
	<a href="/about">å…³äº</a>

	

	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">æ›´æ–°kube-prometheus-stack å¯¼è‡´è‡ªå®šä¹‰labelsç¼ºå¤±</h1>

    <div class="tip">
        <time datetime="2022-01-18 21:57:03 &#43;0800 CST">2022å¹´01æœˆ18æ—¥</time>
        <span class="split">
          Â·
        </span>
        <span>
          483å­—
        </span>
        <span class="split">
          Â·
        </span>
        <span>
          1åˆ†é’Ÿ
        </span>
    </div>

    
    


    <div class="content">
      <h2 id="tldr">TL;DR <a href="#tldr" class="anchor">ğŸ”—</a></h2><p>k8s é›†ç¾¤æ›´æ–°ç›‘æ§ <a href="https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack" target="_blank" rel="noopener">kube-prometheus-stack</a>å¯¼è‡´k8s resourcesè‡ªå®šä¹‰labels ä¸¢å¤±</p>
<p>Chart Versionï¼š 19.2.3 &mdash;&gt; 30.0.1</p>
<p><strong>Resolution</strong>ï¼šéœ€è¦æŒ‡å®š <strong>metricLabelsAllowlist</strong>å‚æ•°</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#080;font-style:italic"># --set è¡¨ç¤ºå“ªäº› k8s resource éœ€è¦è·å–è‡ªå®šä¹‰ metrics labels</span>
helm upgrade kube-prometheus-stack --set kube-state-metrics.metricLabelsAllowlist<span style="color:#666">=</span><span style="color:#b44">&#39;{namespces=[*],pods=[*],deployments=[*],cronjobs=[*],job=[*],daemonsets=[*],statefulsets=[*],replicasets=[*],services=[*]}&#39;</span> -f values.yaml prometheus-community/kube-prometheus-stack --version<span style="color:#666">=</span>30.0.1 -n kube-prometheus-stack

<span style="color:#080;font-style:italic"># å¦‚æœä¸æŒ‡å®š --setï¼Œåˆ™éšå¼è¡¨è¾¾ä¸º --set kube-state-metrics.metricLabelsAllowlist=&#39;{namespces=[*]}&#39;</span>
</code></pre></div><h2 id="question-description">Question Description <a href="#question-description" class="anchor">ğŸ”—</a></h2><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œk8sé›†ç¾¤éƒ½ä¼šå®‰è£…éƒ¨ç½²ä¸€å¥—ç›‘æ§ç³»ç»Ÿ prometheus + grafana æ¥ç›‘æ§å’Œå±•ç¤ºé›†ç¾¤ä¸­ä¸šåŠ¡åº”ç”¨åŸºæœ¬ä¿¡æ¯</p>
<p>åœ¨æ­£å¸¸éƒ¨ç½²åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬ä¼šåŠ ä¸€äº›è‡ªå®šä¹‰çš„ label ,ä¾‹å¦‚ï¼šserviceã€moduleã€ownerç­‰ç­‰ï¼Œå¹¶å°†è¿™äº› labelsæ·»åŠ åˆ°å‘Šè­¦é‚®ä»¶ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½å¤Ÿè¿…é€Ÿå®šä½å“ªäº›ä¸šåŠ¡æ¨¡å—å‘ç”Ÿäº†é—®é¢˜ï¼Œè¿™äº›ä¸šåŠ¡æ¨¡å—æ˜¯ç”±è° è´Ÿè´£ã€‚ä»¥ä¿è¯ç¬¬ä¸€æ—¶é—´èƒ½å¤Ÿå¤„ç†é—®é¢˜å¹¶é€šçŸ¥åˆ°ç›¸å…³äººå‘˜</p>
<p>ç”±äºå…¬å¸ä¸šåŠ¡å¸ƒå±€ï¼Œç»„å†…ç»´æŠ¤äº†å¾ˆå¤šå¥— k8sé›†ç¾¤ï¼Œåœ¨æŸæ¬¡å‘Šè­¦é‚®ä»¶ä¸­ï¼Œå‘ç°è‡ªå®šä¹‰çš„ labels éƒ½ä¸è§äº†ï¼Œä½†æ˜¯å…¶ä»–é›†ç¾¤å´æ²¡æœ‰é—®é¢˜ã€‚ç„¶åå°±è¿½è¸ªåˆ°ç›‘æ§ç‰ˆæœ¬çš„é—®é¢˜ã€‚</p>
<p>æ­¤é—®é¢˜åœ¨å®˜æ–¹<a href="https://github.com/kubernetes/kube-state-metrics/issues/1489" target="_blank" rel="noopener">kube-state-metrics issue</a>å’Œ <a href="https://kubernetes.io/blog/2021/04/13/kube-state-metrics-v-2-0/" target="_blank" rel="noopener">kubernetes blog</a> ä¸­éƒ½æœ‰æåˆ°ï¼Œä»¥æ­¤ç¡®å®šæ˜¯ <strong>metricLabelsAllowlist</strong> å¯¼è‡´çš„</p>
<p><strong>Tip</strong>ï¼š<strong>helm upgrade &ndash;set ç”¨æ³•</strong></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#080;font-style:italic"># valueä¼šæœ‰ä¸¤ç§æƒ…å†µï¼š å•ä¸ªå€¼ å’Œ å¤šå€¼åˆ—è¡¨</span>
--set <span style="color:#b8860b">key</span><span style="color:#666">=</span>value
example: --set xxx.enabled<span style="color:#666">=</span><span style="color:#a2f">false</span>

--set <span style="color:#b8860b">key</span><span style="color:#666">=</span>valueList
example: --set xxx.list<span style="color:#666">=</span><span style="color:#b44">&#39;{value1,value2,value3}&#39;</span>

</code></pre></div>
    </div>

    
        <div class="tags">
            
                <a href="https://www.tinystone.top/tags/kubernetes">Kubernetes</a>
            
                <a href="https://www.tinystone.top/tags/prometheus">Prometheus</a>
            
                <a href="https://www.tinystone.top/tags/kube-state-metrics">Kube-state-metrics</a>
            
        </div>
    
    
    

</section>


    </main>
    
    <footer id="footer">
    

    <div class="copyright">
    
       Â© Copyright 
       2022 
       <span class="split">
        <svg fill="#bbbbbb" width="15" height="15" version="1.1" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 15 15">
  <path d="M13.91,6.75c-1.17,2.25-4.3,5.31-6.07,6.94c-0.1903,0.1718-0.4797,0.1718-0.67,0C5.39,12.06,2.26,9,1.09,6.75&#xA;&#x9;C-1.48,1.8,5-1.5,7.5,3.45C10-1.5,16.48,1.8,13.91,6.75z"/>
</svg>
       </span>
       Taurus Tiny
    
    </div>

    
</footer>



  </body>
</html>
